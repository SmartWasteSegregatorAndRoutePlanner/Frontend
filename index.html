<!DOCTYPE html>
<html lang="en">

<head>
    <title> Waste segregator - Final year Project </title>

    <meta charset="utf-8">
    <meta name="Description"
        content="Waste segregator is a simple prototype to segregate wastes into different types at the source of the waste itself and then differentiate and let it go its disposal sites.">

    <!--BOOTSTRAP CDN-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <!--TAILWIND CSS CDN-->

    <!--FAVICON-->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!--CUSTOM STYLE LINKS-->
    <link rel="stylesheet" href="./static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">

    <!-- CUSTOM JS scripts -->
    <script type="text/javascript" src="./static/js/script.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>

</head>

<body>
    <nav class="navbar top" height="40rem">
        <div class="title">&nbsp;&nbsp;<b><em>Smart Waste Segregation and Route Planner</em></b></div>
        <p class="muted-text"></p>
        <a href="#" class="toggle-button">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </a>
        <div class="navbar-links">
            <ul>
                <li><a href="#route-planner-section" target="_self">Route Planner</a></li>
                <li><a href="#about-project" target="_self">About Project</a></li>
                <li><a href="/login.html" target="_self" onclick="deleteAllCookies()"><strong>Logout</strong></a></li>
            </ul>
        </div>
    </nav>

    <div class="college-logo-section">
        <br><br><br><br><br>
        <div class="row">
            <div class="col-md-3 college-logo">
                <img src="https://i.ibb.co/k8TZ37C/logo-removebg-preview.png" class="align-right img-fluid"
                    alt="college-logo" />
                <p>Kanakia Park, Mira Road(East)
                <p>
            </div>
            <div class="col-md-7">
                <h2 class="align-justify project-title"><strong><em>Smart Waste Segregation and Route
                            Planner</em></strong></h2>
                <br><br>

                <h3 class="align-left guide-name"><strong>Guide:</strong><em> Prof. Shruti Patil</em></h3><br>

                <div class="container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Roll Number</th>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>12</td>
                                <td>Rahul Gupta</td>
                            </tr>
                            <tr>
                                <td>18</td>
                                <td>Shubh Kansara</td>
                            </tr>
                            <tr>
                                <td>26</td>
                                <td>Dhrumil Mistry</td>
                            </tr>
                            <tr>
                                <td>36</td>
                                <td>LSD Priyanka Peddinti</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
        <br><br><br>
    </div>

    <!-- DATA ANALYSSIS OF WASTE SEGREGATION -->
    <!-- <div class="section-2 data-analysis">
        <div class="row row featurette">
            <div class="col-md-4"></div>

            <div class="col-md-4">
                <div class="card" style="width: 25rem;">
                    <img src="https://cdn.pixabay.com/photo/2016/11/27/21/42/stock-1863880_960_720.jpg" class="card-img-top" alt="data-card-1" >
                    <div class="data-card-1">
                      <h5 class="data-analysis-title">WASTE ANALYSIS</h5>
                      <p class="data-analysis-description">The waste that gets detected by the camera / conveyor belt while segregation gets classfied on the cloud model that differentiates between different types of waste and then gives data accordingly.</p>
                      <a href="" class="btn btn-primary">See the suggested route map!</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4"></div>
        </div>
    </div>
    <br> -->
    <section id="classless-labels-section" class="mx-auto my-auto">
        <div class="row my-auto mx-auto" id="classless-labels">
            <h4 class="map-analysis-title"><strong>Classless Labels</strong></h4>
            <div id="classless-labels-alert"></div>
            <div id="classless-labels-table"></div>
            <div>
                <button class="btn btn-primary" onclick="getClasslessLabels()">Update Classess Labels
                    List</button>
            </div>

        </div>
    </section>

    <section class="section-3" id="route-planner-section">
        <!--MAP AND ROUTE PANNER OF GARBAGE VANS-->
        <div class="section-3 route-planner">
            <div class="map-analysis">
                <div class="row row featurette">
                    <div class="col-md-4">
                        <div class="card">
                            <img src="https://cdn.pixabay.com/photo/2016/11/25/18/30/tourist-1858958__340.jpg"
                                class="card-img-top" alt="data-card-1">
                            <div class="data-card-1">
                                <h5 class="map-analysis-title"><strong>ROUTE PLANNER MAP</strong></h5>
                                <p class="map-analysis-description">The waste that has been continously segregated and
                                    whose data has been been integrated with the cloud is now available with the local
                                    garbage truck drivers of each kind. <br>
                                    Garbage of each type ie - Degradable and non degradable will now be shown to trucks
                                    and the drivers can decide based on the quantity of the waste as to when to pick up
                                    at which point and when to skip</p>

                                <button class="btn btn-primary" onclick="updateMap()">Create Routes</button>
                                <button class="btn btn-primary" onclick="getMap()">Fetch Routes</button><br><br>
                            </div>
                        </div>
                    </div>
                    <div id="route-viewer" class="col">
                        <div id="route-alert"></div>
                        <div id="route-map" class="my-auto"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="landing-page-1" id="about-project">
        <div class="row">
            <div class="col-md-5">

                <h1>Smart Waste segregation, disposal & Route Planner</h1>
                <br><br><br><br><br>
                <br><br><br><br><br>
                <h3>
                    <ul> <br><br>
                        <li>* Segregate waste at source </li>
                        <li>* Data on waste generation</li>
                        <li>* Highly optimised route planner for garbage collection vans</li>
                    </ul>
                </h3>
            </div>

            <div class="col-md-1"></div>
            <div class="col-md-6 landing-i1 rounded">
                <img src="./static/images/landing-1.JPG" class="rounded border image-fluid">
            </div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://swsrp.dmdhrumilmistry.tech:8000/api';

        // check if user has access to view page
        const authToken = getAuthToken();

        // endpoints
        // authentication
        const loginToken = '/token/';
        const loginRefresh = '/token/refresh/';

        // route-planner
        const routePlanner = '/route-planner/';
        const updateRoutes = '/route-planner/update-routes';

        // recognition
        const recognition = '/recognition/recognize';

        function getEndpoint(baseUrl, endpoint) {
            return baseUrl + endpoint + '?format=json';
        }

        function updateClasslessLabelnAlert(alertType, message) {
            const routeAlert = document.getElementById("classless-labels-alert");
            routeAlert.innerHTML = `<div class='alert alert-${alertType} alert-dismissible fade show' role='alert'>${message}<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>`;
        }

        function updateRouteAlert(alertType, message) {
            const routeAlert = document.getElementById("route-alert");
            routeAlert.innerHTML = `<div class='alert alert-${alertType} alert-dismissible fade show' role='alert'>${message}<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div>`;
        }

        const api = axios.create({
            timeout: 30000, // in ms
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + getAuthToken()
            },
        });

        function getMap() {
            const endpoint = getEndpoint(baseUrl, routePlanner);
            const routeMapTag = document.getElementById("route-map");

            api.get(endpoint)
                .then(function (response) {
                    console.log(response.data);
                    routeMapTag.innerHTML = response.data;
                    updateRouteAlert("success", "Routes Fetched Successfully");
                    return response.data;
                })
                .catch(function (error) {
                    console.error(error);
                    updateRouteAlert("danger", "Failed to fetch updated routes!");
                })
        }

        function updateMap() {
            const endpoint = getEndpoint(baseUrl, updateRoutes);
            updateRouteAlert("warning", "Routes are being calculated, Please wait for few seconds.");
            api.get(endpoint)
                .then(function (response) {
                    console.log(response.data);
                    if (response.status == 201) {
                        updateRouteAlert("success", "Routes are ready! Click on Fetch Routes Button to view Routes.");
                    } else {
                        updateRouteAlert("warning",)
                    }
                    return response.data;
                })
                .catch(function (error) {
                    updateRouteAlert("danger", "Failed to calculate routes! View console for more information.");
                    console.error(error);
                })
        }

        function refreshToken(token) {
            const endpoint = getEndpoint(baseUrl, refreshAuthToken);
            api.post(endpoint, {
                "refresh": refreshAuthToken
            })
                .then(function (response) {
                    console.log(response.data);
                    return response.data;
                })
                .catch(function (error) {
                    console.error(error);
                })
        }

        function getClasslessLabels() {
            const endpoint = getEndpoint(baseUrl, recognition);
            const tableTag = document.getElementById("classless-labels-table");

            api.get(endpoint)
                .then(function (response) {
                    const unconfiguredLabels = response.data.unconfigured_labels;
                    if (unconfiguredLabels) {
                        let table = '<table class="table table-striped"><thead><tr><th scope="col">#</th><th scope="col">Label</th></tr></thead>';
                        for (const unconfiguredLabel of unconfiguredLabels) {
                            table += `<tr><th>${unconfiguredLabel.id}</th><td>${unconfiguredLabel.label}</td></tr>`
                        }
                        tableTag.innerHTML = table + '</table>';
                    } else {
                        tableTag.innerHTML = '';
                    }
                    console.log(response.data);
                    updateClasslessLabelnAlert("success", response.data.msg);
                })
                .catch(function (error) {
                    console.error(error);
                    updateClasslessLabelnAlert("danger", "Failed to fetch Classess Labels!");
                })
        }
        // page init
        updateRouteAlert("warning", "Click on Fetch Routes Button to Fetch Routes");
        getClasslessLabels();

    </script>
</body>

</html>